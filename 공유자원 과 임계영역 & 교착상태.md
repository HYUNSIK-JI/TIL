## 공유 자원 과 임계 영역



### 공유 자원

공유 자원(shared resource)은 시스템 안에서 각 프로세스, 스레드가 함께 접근 할 수 있는

모니터, 프린트, 메모리, 파일, 데이터 등의 자원이나 변수를 말한다.

이 공유 자원을 두개 이상의 프로세스가 동시에 읽거나  쓰는 상황을 경쟁 상태(race condition)

이라 한다. 동시에 접근을 시도할 때 접근의 타이밍 이나 순서 등이 결괏값에 영향을 줄 수 있다.



ex)![공유 자원](C:\Users\user\Desktop\이미지모음\공유 자원.png)



프로세스 A와 프로세스 B 가 동시에 접근 할때 타이밍 서로 꼬여 정상 결과값 300인데

200이 출력된다.



### 임계영역

공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 영역을 임계 영역(critical section)이라 한다.

임계 영역을 해결하기 위한 방법은 뮤텍스, 세마포어, 모니터 세 가지 있으며, 이 세 가지 방법 모두

상호 배제, 한정 대기, 융통성이란 조건을 만족한다.



이 방법에 토대가 되는 메커니즘은 잠금(lock)이다. ex) 임계 구역을 화장실 이라고 가정하면

화장실에 A라는 사람이 들어간 다음 문을 잠군다. 그리고 다음 사람이 이를 기다리다 A가 나오면

화장실을 쓸수 있는것이다.



#### 상호배제

한 프로세스가 임계영역에 들어갔을때 다른 프로세스는 들어갈 수 없다.

#### 한정 대기

특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안된다.

#### 융통성

한 프로세스가 다른 프로세스의 일을 방해해서는 안된다.



### 뮤텍스

뮤텍스(mutex)는 공유 자원을 사용하기 전에 설정하고 사용한 후에 해제하는 잠금이다.

잠금이 설정되면 다른 스레드는 잠긴 코드 영역에 접근할수 없다. 또한 뮤텍스는 하나의 상태만

가진다.



![뮤텍스](C:\Users\user\Desktop\이미지모음\뮤텍스.png)



### 세마포어

세마포어(semaphore)는 일반화된 뮤텍스이다. 간단한 정수 값과 두 가지 함수 wait 및 signal로

공유 자원에 대한 접근을 처리 한다.

wait()는 자신의 차례가 올 때 까지 기다리는 함수이며, signal()은 다음 프로세스로 순서를 넘겨주는

함수이다.

![세마포어](C:\Users\user\Desktop\이미지모음\세마포어.png)

프로세스가 공유 자원에 접근하면 세마포어에서 wait() 작업을 수행하고 프로세스가 공유 자원

을 해제하면 세마포어에서 signal() 작업을 수행한다. 세마포어에는 조건 변수가 없고

프로세스가 세마포어 값을 수정할 때 다른 프로세스는 동시에 세마포어 값을 수정 할수 없다.



#### 바이너리 세마포어

바이너리 세마포어는 0과 1의 두 가지 값만 가질수 있는 세마포어 이다.

구현의 유사성으로 인해 뮤텍스는 바이너리 세마포어라고 할 수있다. 하지만 엄밀히 말하면

뮤텍스는 리소스에 대한 접근을 동기화 하는데 사용되는 메커니즘이고, 세마포어는 신호를

기반으로 상호 배제가 일어나는 신호 메커니즘 이다.



ex) 휴대폰에서 노래를 듣다가 친구로부터 전화가 오면 노래가 중지 되고 통화처리 작업에 관한

인터페이스가 등장하는 것을 상상하면 된다.



#### 카운팅 세마포어

카운팅 세마포어는 여러 개의 값을 가질 수 있는 세마포어이며, 여러 자원에 대한 접근을 제어하는데

사용된다.



#### 모니터

모니터는 둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근 할수 있도록 공유 자원을

숨기고 해당 접근에 대해 인퍼페이스만 제공한다.

모니터는 모니터큐를 통해 공유 자원에 대한 작업들을 순차적으로 처리한다.

모니터는 세마포어보다 구현하기 쉬우며, 모니터에서 상호 배제는 자동인 반면, 세마포어에서는

상호배제를 명시적으로 구현해야하는 차이점이 존재한다.



## 교착상태

교착상태(deadlock)는 두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태를 말한다.

![교착상태](C:\Users\user\Desktop\이미지모음\교착상태.jpeg)

ex) 프로세스 a가 프로세스 b의 어떤 자원을 요청 할때 프로세스 b도 프로세스 a가 점유하고 있는

자원을 요청하는 상황을 말한다. 해결 방법은 다음과 같다.



### 교착상태의 원인

* 상호 배제:한 프로세스가 자원을 독점하고 있으며 다른 프로세스들이 접근이 불가능하다.

* 점유 대기:특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태

* 비선점:다른 프로세스의 자원을 강제적으로 가져 올수 없다.

* 환형 대기: 프로세스 a는 프로세스 b를 요구 하고, 프로세스 b는 프로세스 a의 자원을 요구

  하는 등 서로가 서로의 자원을 요구 하는 상황을 말한다.



### 교착상태 해결 방법

1. 자원을 할당 할때 애초에 조건이 성립되지 않도록 설계한다.

2. 교착 상태 가능성이 없을 때만 자원 할당되며, 프로세스 당 요청할 자원들의 최대치를 통해

   자원 할당 가능 여부를 파앍하는 '은행원 알고리즘'을 쓴다.

3. 교착 상태가 발생하면 사이클이 있는지 찾아보고 이에 관련된 프로세스를 한개씩 지운다.

4. 교착 상태는 매우 드문 현상이므로 이를 처리 하는 비용이 더 커서 교착 상태가 발생하면

   작업을 종료한다. 현대 운영체제는 이 방식을 채택했다. ex) 프로세스를 실행시키다 '응답없음'

   이라고 뜰 때가 있다. 교착 상태가 발생한 경우 이와 같은 경우가 발생하기도 한다.

